- classes = []
- classes << 'visible' if !@filter.errors.empty? || params[:show]
- content = @filter.content || {}
- content[:features] ||= []
- content[:features] = content[:features].map{|feature| feature =~ /^\d+$/ ? feature.to_i : nil}.compact
- slice_size = 4

.filter_container.twelve.columns.centered#Filter{data: {filter: 'data-filter'}, class: classes}
  = form_for @filter, url: projects_path, method: :get, remote: true do |f|
    - if @filter.errors.any?
      .row
        .twelve.columns#error_explanation
          %h2= "#{pluralize(@filter.errors.count, "error")} prohibited this filter from being saved:"
          %ul
            - @filter.errors.full_messages.each do |msg|
              %li= msg
  
    .row.section
      = f.hidden_field :id
      = f.hidden_field :area
      .twelve.columns
        = f.label :name
        = f.text_field :name
    
    .row.section
      - Feature.active.each_slice(slice_size) do |features|
        .row.features
          - features.each_with_index do |feature, i|
            - classes = 'end' if features.length < slice_size && i == features.length-1
            .three.columns.features{class: classes}<
              = check_box_tag 'filter[content][features][]', feature.id, content[:features].include?(feature.id), id: "filter_content_features_#{feature.id}"
              = label_tag "filter_content_features_#{feature.id}", feature.name, class: 'inline_label'

    .row
      .four.columns.offset-by-eight.text-right.actions
        = submit_tag 'Apply', name: :apply
        - if @filter.new_record?
          \|
          = submit_tag 'Save', name: :commit_filter
        - else
          \|
          = submit_tag 'Update', name: :commit_filter
          \|
          = link_to 'Delete', projects_path(destroy: true), method: :delete, data: { confirm: "#{t(:warning_html, scope: :filter)}" }, remote: true
        \|
        = link_to 'Close', 'javascript:void();', data: {filter_close: true}
