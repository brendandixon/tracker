- if @tasks.is_a?(IterationEnumerator)
  - projects = @filter.content[:projects] || @tasks.team.projects.map{|p| p.id}
  - states = @filter.content[:status] || StatusScopes::ALL_STATES
- printing = false if printing.nil?

#Main
  - unless printing
    .row
      .span7
        = render 'shared/filter_header'

  - if printing
    - if @tasks.is_a?(IterationEnumerator)
      - @tasks.each_iteration(0) do |iteration|
        - tasks = iteration.tasks.find_all{|task| states.include?(task.status) && projects.include?(task.project.id)}
        - break
    - else
      - tasks = @tasks
    - tasks.each_slice(3) do |row_tasks|
      .row
        - row_tasks.compact.each do |task|
          .span4
            = render partial: 'task', locals: {task: task, printing: true, stand_alone: true}

  - else
    .row
      .span7
        - if @tasks.is_a?(IterationEnumerator)
          - @tasks.each_iteration(printing ? 0 : -1) do |iteration|
            .iteration-marker{data: {iteration: iteration.number, collapsed: 0}}
              .row.iteration-toggle
                .span2
                  .glyphicon.collapse_top
                  .date= iteration.end_date.to_formatted_s(:medium)
                .span3
                  %span.badge.badge-inverse= iteration.points
                  \|
                  %span.badge.badge-success= iteration.completed
                  %span.badge.badge-info= iteration.in_progress
                  %span.badge.badge-important= iteration.pending
            
            %ol.unstyled.task-list{data: {iteration: iteration.number}}<
              - tasks = iteration.tasks.find_all{|task| states.include?(task.status) && projects.include?(task.project.id)}
              - if tasks.count > 0
                = render partial: 'task', collection: tasks, locals: {edited: @edited, expanded: @expanded}
              - else
                %li{data: {iteration: iteration.number, collapsed: 0, empty: 1}}
                  %h3.subheader= t(:none_html, scope: [:controllers, :tasks])

          %div
            :javascript
              $(function() {$('body').trigger('iteration.visibility');});

        - else
          - unless printing
            .row-fluid.task-sort
              %table.table
                %thead
                  %tr
                    = render partial: 'shared/sortable', locals: {name: 'Title', field: 'title', classes: 'span5'}
                    = render partial: 'shared/sortable', locals: {name: 'Points', field: 'point', classes: 'span3'}
                    = render partial: 'shared/sortable', locals: {name: 'Status', field: 'status', classes: 'span4 last'}

            .row
              .span7
                %ol.unstyled.task-list<
                  - if @tasks.count > 0
                    = render partial: 'task', collection: @tasks, locals: {edited: @edited, expanded: @expanded}
                  - else
                    %li{data: {collapsed: 0, empty: 1}}
                      %h3.subheader= t(:none_html, scope: [:controllers, :tasks])
    
    = render template: 'shared/bind_list'
